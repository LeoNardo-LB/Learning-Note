# 垃圾回收概述

## 垃圾（Garbage）的概念

垃圾是指在运行程序中没有任何指针指向的对象，这个对象就是需要被回收的垃圾。

如果不及时堆内存中的垃圾进行清理，那么这些垃圾对象所占的内存空间会一直保留到应用程序的结束。这可能导致空间不足，无法被其他对象使用。甚至导致**内存溢出**。



## 需要GC的原因

-   对于高级语言而言，若不进行垃圾回收，内存用完只是迟早的事
-   除了释放失效的对象，GC也可以清理内存里的记录锁片，将碎片整理到一边，JVM就可以分配出整块内存（连续空间）给新的对象（数据）
-   随着业务场景的日趋复杂，需要处理的数据量越来越大，因此GC需要不断优化



## 早期垃圾回收

C与C++语言，开发人员可以使用new关键字进行内存申请，并使用delete关键字进行内存释放。

```c++
MibBridge *pBridge= new cmBaseGroupBridge（）；
//如果注册失败，使用Delete释放该对象所占内存区域
if（pBridge->Register（kDestroy）！=NO ERROR）
	delete pBridge；
```

这种方式可以灵活控制内存释放的时间，但是会给开发人员带来频繁申请和释放内存的管理负担。

倘若有一处内存区间由于程序员编码的问题忘记被回收，那么就会产生**内存泄漏**，垃圾对象永远无法被清除，随着系统运行时间的不断增长，垃圾对象所耗内存可能持续上升，直到出现**内存溢出**并造成应用程序崩溃。

内存泄漏：内存泄漏是指 在逻辑上不需要使用，但没有被清除的对象。可能占有多个引用



##  Java垃圾回收机制

### 优点

1.  自动内存管理，无需开发人员手动参与内存的分配与回收，这样降低内存泄漏和内存溢出的风险

2.  没有垃圾回收器，java也会和cpp一样，各种悬垂指针，野指针，泄露问题让。

3.  自动内存管理机制，将程序员从繁重的内存管理中释放出来，可以更专心地专注于业务开发

点击此处：[oracle官网关于垃圾回收的介绍 ](https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/toc.html)

###  担忧

1.  对于Java开发人员而言，自动内存管理就像是一个黑匣子，如果过度依赖于“自动”，那么这将会是一场灾难，最严重的就会弱化Java开发人员在程序出现内存溢出时定位问题和解决问题的能力。

2.  此时，了解JVM的自动内存分配和内存回收原理就显得非常重要，只有在真正了解JVM是如何管理内存后，我们才能够在遇见outofMemoryError时，快速地根据错误异常日志定位问题和解决问题。

3.  当需要排查各种内存溢出、内存泄漏问题时，当垃圾收集成为系统达到更高并发量的瓶颈时，我们就必须对这些“自动化”的技术实施必要的监控和调节。

###  GC主要关注的区域

GC主要关注于 **方法区** 和 **堆** 中的垃圾收集

![image-20200712092427246](_images/image-20200712092427246.png)

垃圾收集器可以对年轻代回收，也可以对老年代回收，甚至是全栈和方法区的回收。其中，Java堆是垃圾收集器的工作重点。

从次数上讲：

-   频繁收集Young区
-   较少收集Old区
-   基本不收集Perm区（元空间）